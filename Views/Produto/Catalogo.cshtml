@model IEnumerable<MotoPack_project.Models.Produto>

@{
    ViewData["Title"] = "Catálogo";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var precoMin = ViewBag.PrecoMin ?? 0;
    var precoMax = ViewBag.PrecoMax ?? 1000;
    var precoAtual = ViewBag.PrecoSelecionado ?? precoMax;
    var categoriaAtual = ViewBag.CategoriaAtual as string ?? "";
    var termoPesquisa = ViewBag.SearchTerm as string ?? "";
}

<style>
    .conteudo {
        display: flex;
        gap: 20px;
    }

    .filtros {
        width: 220px;
        background-color: #f5f5f5;
        padding: 10px;
        border-radius: 8px;
        height: fit-content;
    }

    .produtos {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
    }

    .produto {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: inherit;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: white;
        height: 320px;
    }

        .produto img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
        }

    .descricao {
        color: black;
        font-size: 14px;
        text-align: center;
        max-height: 3.6em;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .filtros h3 {
        margin-bottom: 1rem;
    }

    .filtros a {
        text-decoration: none;
        color: inherit;
    }

        .filtros a:hover {
            text-decoration: underline;
        }

    .slider-value {
        margin-top: 5px;
        font-size: 14px;
    }

    .filtros form button {
        margin-top: 10px;
    }

    .filtros .repor {
        margin-top: 15px;
        display: block;
    }
</style>

<a href="@Url.Action("AdicionarProduto", "Produto")" class="btn btn-primary mb-3">Adicionar Novo Produto</a>

<div class="conteudo">
    <div class="filtros">
        <h3><strong>FILTROS</strong></h3>

        <div class="categorias">
            <p><strong>Categorias</strong></p>
            <ul>
                @{
                    var categorias = new[]
                    {
                "Eletricidade e Iluminação", "Carroçaria", "Travões", "Filtros", "Suspensão",
                "Motor", "Escapamento", "Sistema de combustível", "Sistema de Refrigeração",
                "Sistema de transmissão", "Fluidos ou Químicos", "Rodas"
                };
                }

                @foreach (var cat in categorias)
                {
                    <li>
                        <a href="@Url.Action("Catalogo", "Produto", new { categoria = cat, search = termoPesquisa })">@cat</a>
                    </li>
                }
            </ul>
        </div>

        <form method="get" asp-action="Catalogo">
            @if (!string.IsNullOrEmpty(categoriaAtual))
            {
                <input type="hidden" name="categoria" value="@categoriaAtual" />
            }
            @if (!string.IsNullOrEmpty(termoPesquisa))
            {
                <input type="hidden" name="search" value="@termoPesquisa" />
            }

            <label><strong>Preço até:</strong></label><br />
            <input type="range" id="priceRange" name="precoMax"
                   min="@precoMin" max="@precoMax" value="@precoAtual" />
            <p class="slider-value">Selecionado: <span id="priceValue">@precoAtual</span>€</p>

            <button type="submit" class="btn btn-sm btn-primary">Aplicar</button>
        </form>

        <a href="@Url.Action("Catalogo", "Produto")" class="btn btn-sm btn-secondary repor">Repor Filtros</a>
    </div>

    <div class="produtos">
        @if (!string.IsNullOrEmpty(categoriaAtual))
        {
            <h5>Filtrando por categoria: <em>@categoriaAtual</em></h5>
        }

        @if (!string.IsNullOrEmpty(termoPesquisa))
        {
            <h5>Resultados da pesquisa por: <em>"@termoPesquisa"</em></h5>
        }

        @if (!Model.Any())
        {
            <p>Nenhum produto encontrado com os filtros atuais.</p>
        }
        else
        {
            @foreach (var produto in Model)
            {
                <div class="produto">
                    <a href="@Url.Action("Produto", "Produto", new { id = produto.Id })">
                        <img src="@produto.ImageUrl" alt="imagem da peça" />
                        <p><strong>@produto.Nome / @produto.Preco.ToString("0.00") €</strong></p>
                    </a>
                </div>
            }
        }
    </div>
</div>

<script>
    const priceSlider = document.getElementById('priceRange');
    const priceValue = document.getElementById('priceValue');

    if (priceSlider && priceValue) {
        priceSlider.addEventListener('input', function () {
            priceValue.textContent = this.value;
        });
    }
</script>
